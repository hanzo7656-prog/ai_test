name: ğŸš€ Keep Render Service Alive

on:
  schedule:
    # Ù‡Ø± Û±Û° Ø¯Ù‚ÛŒÙ‚Ù‡ Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯
    - cron: '*/10 * * * *'
  push:
    branches: [ main ]
  workflow_dispatch:  # Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ

env:
  SERVICE_URL: 'https://YOUR_APP_NAME.onrender.com'

jobs:
  health-check:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“ Check Basic Health
        run: |
          echo "ğŸ• Starting health check at $(date)"
          
          # ØªØ³Øª endpoint Ø³Ø§Ø¯Ù‡
          response=$(curl -s -w "\nHTTP_STATUS:%{http_code}" "$SERVICE_URL/api/health/ping")
          http_status=$(echo "$response" | grep "HTTP_STATUS" | cut -d':' -f2)
          
          if [ "$http_status" -eq 200 ]; then
            echo "âœ… Basic health check passed"
          else
            echo "âŒ Basic health check failed: HTTP $http_status"
            exit 1
          fi

      - name: ğŸ“Š Check Full Health Status
        run: |
          echo "ğŸ” Checking full health status..."
          
          response=$(curl -s -w "\nHTTP_STATUS:%{http_code}" "$SERVICE_URL/api/health/status")
          http_status=$(echo "$response" | grep "HTTP_STATUS" | cut -d':' -f2)
          json_response=$(echo "$response" | grep -v "HTTP_STATUS")
          
          if [ "$http_status" -eq 200 ]; then
            echo "âœ… Full health check passed"
            echo "ğŸ“ˆ Health Score: $(echo "$json_response" | grep -o '"health_score":[0-9]*' | cut -d':' -f2)"
            echo "ğŸ”„ Status: $(echo "$json_response" | grep -o '"status":"[^"]*' | cut -d'"' -f4)"
          else
            echo "âŒ Full health check failed: HTTP $http_status"
            echo "Response: $json_response"
            exit 1
          fi

      - name: ğŸ“ Log Success
        if: success()
        run: |
          echo "ğŸ‰ All health checks passed at $(date)"
          echo "âœ… Service is running smoothly"
          echo "ğŸŒ Service URL: $SERVICE_URL"

      - name: ğŸš¨ Log Failure  
        if: failure()
        run: |
          echo "ğŸ’¥ Health checks failed at $(date)"
          echo "ğŸ”§ Check the service logs for details"
          echo "ğŸŒ Service URL: $SERVICE_URL"
