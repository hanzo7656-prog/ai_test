- name: ğŸ’¾ Smart Memory Management
  run: |
    echo "ğŸ§  Checking system resources..."
    
    resources=$(curl -s "$SERVICE_URL/api/health/resources")
    
    # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¯Ø±Ø³Øª memory Ø§Ø² Ø¨Ø®Ø´ memory
    memory_usage=$(echo "$resources" | grep -o '"memory":{"percent":[0-9.]*' | cut -d':' -f3)
    disk_usage=$(echo "$resources" | grep -o '"disk":{"percent":[0-9.]*' | cut -d':' -f3)
    
    echo "ğŸ’¾ Memory Usage: ${memory_usage}%"
    echo "ğŸ’½ Disk Usage: ${disk_usage}%"
    
    # Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø§ÙØ¸Ù‡
    if [ -n "$memory_usage" ] && [ "$memory_usage" -gt 75 ]; then
      echo "âš ï¸ High memory usage detected - performing cleanup..."
      curl -X POST "$SERVICE_URL/api/health/cache/clear" || true
      curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
        -d chat_id="$TELEGRAM_CHAT_ID" \
        -d text="ğŸ§¹ MEMORY CLEANUP!%0AğŸ“Š Memory: ${memory_usage}%%0AğŸ•’ $(date +'%H:%M')"
    fi
    
    # Ù‡Ø´Ø¯Ø§Ø± Ø¯ÛŒØ³Ú© Ù¾Ø±
    if [ -n "$disk_usage" ] && [ "$disk_usage" -gt 80 ]; then
      echo "ğŸš¨ High disk usage detected: ${disk_usage}%"
      curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
        -d chat_id="$TELEGRAM_CHAT_ID" \
        -d text="ğŸš¨ HIGH DISK USAGE!%0AğŸ’½ Disk: ${disk_usage}%%0AğŸ”´ Cleanup needed%0AğŸ•’ $(date +'%H:%M')"
    fi
