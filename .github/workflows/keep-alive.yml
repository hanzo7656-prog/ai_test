name: üêõ Debug Telegram

on:
  workflow_dispatch:

env:
  TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
  TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: 1Ô∏è‚É£ Check Secrets Exist
        run: |
          echo "üîç Checking secrets..."
          echo "TELEGRAM_BOT_TOKEN: $TELEGRAM_BOT_TOKEN"
          echo "TELEGRAM_CHAT_ID: $TELEGRAM_CHAT_ID"
          
          if [ -z "$TELEGRAM_BOT_TOKEN" ]; then
            echo "‚ùå TELEGRAM_BOT_TOKEN is empty!"
          else
            echo "‚úÖ TELEGRAM_BOT_TOKEN exists (length: ${#TELEGRAM_BOT_TOKEN})"
          fi
          
          if [ -z "$TELEGRAM_CHAT_ID" ]; then
            echo "‚ùå TELEGRAM_CHAT_ID is empty!"
          else
            echo "‚úÖ TELEGRAM_CHAT_ID exists: $TELEGRAM_CHAT_ID"
          fi

      - name: 2Ô∏è‚É£ Test Telegram API
        run: |
          echo "üß™ Testing Telegram API..."
          response=$(curl -s -w "\nHTTP_STATUS:%{http_code}" \
            -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
            -d chat_id="$TELEGRAM_CHAT_ID" \
            -d text="2Ô∏è‚É£ DEBUG: Test from GitHub Actions - $(date +'%H:%M:%S')")
          
          echo "üì° Full response:"
          echo "$response"
          
          http_status=$(echo "$response" | grep "HTTP_STATUS" | cut -d':' -f2)
          echo "üî¢ HTTP Status: $http_status"

      - name: 3Ô∏è‚É£ Test Simple Message
        run: |
          echo "üì± Sending simple message..."
          curl -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
            -d chat_id="$TELEGRAM_CHAT_ID" \
            -d text="3Ô∏è‚É£ SIMPLE: This should work! $(date +'%H:%M:%S')"
          echo "‚úÖ Simple message sent"
